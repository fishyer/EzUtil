apply plugin: 'maven'

Properties properties = new Properties();
properties.load(new FileInputStream(file("../local.properties")))

def userName = properties.userName
def password = properties.password

def lib_url = properties.lib_url
println("lib_url:" + lib_url)

def lib_groupId = properties.lib_groupId
def lib_artifactId = properties.lib_artifactId
def lib_version = getGitCommitCount()

//maven { url "http://fishyer.vipgz1.idcfengye.com/repository/maven-public/"}
def maven_url = "maven { url \"http://fishyer.vipgz1.idcfengye.com/repository/maven-public/\"}"
println(maven_url)

//implementation 'com.ezbuy:ezutil:5'
def lib_dependency=String.format("implementation '%s:%s:%s'", lib_groupId, lib_artifactId, lib_version)
println(lib_dependency)

def getGitCommitCount() {
    return 'git rev-list HEAD --first-parent --count'.execute().text.trim().toInteger()
}

uploadArchives {
    configuration = configurations.archives

    repositories.mavenDeployer {
        repository(url: lib_url) {
            authentication(userName: userName, password: password)
        }

        pom.project {
            groupId lib_groupId
            artifactId lib_artifactId
            version lib_version
            packaging 'aar'
            description 'none'
        }
    }

}